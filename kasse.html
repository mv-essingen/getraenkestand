<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getränkestand Kasse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 900px;
            margin: auto;
        }
        .drink-button {
            transition: transform 0.1s ease-in-out;
        }
        .drink-button:hover {
            transform: scale(1.02);
        }
        .drink-button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container p-4 sm:p-6 lg:p-8 bg-white shadow-xl rounded-2xl w-full">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Getränkeauswahl -->
            <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Halbe -->
                        <button class="drink-button p-4 bg-yellow-100 rounded-xl shadow border border-yellow-200 hover:bg-yellow-200" onclick="addDrink('Halbe', 4.00, 'krug')">
                            <p class="font-bold text-gray-800">Halbe</p>
                            <p class="text-sm text-gray-600">4,00 €</p>
                        </button>
                        <!-- Weizen -->
                        <button class="drink-button p-4 bg-yellow-100 rounded-xl shadow border border-yellow-200 hover:bg-yellow-200" onclick="addDrink('Weizen', 4.30, 'krug')">
                            <p class="font-bold text-gray-800">Weizen</p>
                            <p class="text-sm text-gray-600">4,30 €</p>
                        </button>
                    </div>
                    <!-- Antialk -->
                    <div class="grid grid-cols-1 gap-4">
                        <button class="drink-button p-4 bg-blue-100 rounded-xl shadow border border-blue-200 hover:bg-blue-200" onclick="addDrink('Antialk', 2.50, 'flasche')">
                            <p class="font-bold text-gray-800">Antialk</p>
                            <p class="text-sm text-gray-600">2,50 €</p>
                        </button>
                    </div>
                </div>
                <div class="mt-8">
                    <!-- Pfandrückgabe-Buttons -->
                    <div class="grid grid-cols-2 gap-4">
                        <button class="drink-button p-4 bg-green-100 rounded-xl shadow border border-green-200 hover:bg-green-200" onclick="returnPfand('krug')">
                            <p class="font-bold text-gray-800">Krug zurück</p>
                            <p class="text-sm text-gray-600">(4,00 €)</p>
                        </button>
                        <button class="drink-button p-4 bg-green-100 rounded-xl shadow border border-green-200 hover:bg-green-200" onclick="returnPfand('flasche')">
                            <p class="font-bold text-gray-800">Flasche zurück</p>
                            <p class="text-sm text-gray-600">(2,00 €)</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Warenkorb & Kasse -->
            <div class="bg-gray-50 p-6 rounded-2xl shadow-inner flex flex-col justify-between">
                <div>
                    <ul id="cart-list" class="space-y-2 mb-4">
                    </ul>
                </div>

                <div class="mt-auto pt-4 border-t border-gray-200">
                    <div class="flex justify-between items-center text-lg font-semibold text-gray-800 mb-2">
                        <span>Getränke:</span>
                        <span id="subtotal">0,00 €</span>
                    </div>
                    <div class="flex justify-between items-center text-lg font-semibold text-gray-800 mb-2">
                        <span>Pfand:</span>
                        <span id="pfand-sum">0,00 €</span>
                    </div>
                    <div class="flex justify-between items-center text-2xl font-bold mt-2">
                        <span>Gesamt:</span>
                        <span id="total">0,00 €</span>
                    </div>
                    <div class="flex justify-between items-center text-2xl font-bold mt-2">
                        <span>Pfandmarken:</span>
                        <span id="pfand-marken-gesamt">0</span>
                    </div>
                    
                    <p class="text-sm text-gray-500 mt-2 text-center">
                        <span class="text-green-600 font-bold">Grün</span> = wir bekommen
                        <br>
                        <span class="text-red-600 font-bold">Rot</span> = wir geben
                    </p>

                    <div class="flex justify-center items-center mt-6">
                        <button class="px-4 py-3 bg-red-500 text-white font-bold rounded-lg shadow-md hover:bg-red-600 transition w-full" onclick="clearCart()">
                            <p>Neu</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Array zum Speichern der Warenkorb-Elemente
        let cart = [];
        
        // Konstanten für Pfandwerte
        const P_KRUG = 4.00;
        const P_FLASCHE = 2.00;

        // Funktion zum Hinzufügen eines Getränks zum Warenkorb
        function addDrink(name, price, type) {
            cart.push({ name, price, type, isMain: true });
            let pfandName = (type === 'krug') ? 'Pfand Krug' : 'Pfand Flasche';
            let pfandPrice = (type === 'krug') ? P_KRUG : P_FLASCHE;
            cart.push({ name: pfandName, price: pfandPrice, type: type, isMain: false });
            updateCart();
        }

        // Funktion für Pfandrückgabe
        function returnPfand(type) {
            if (type === 'krug') {
                cart.push({ name: 'Krug zurück', price: -P_KRUG, type: 'krug', isMain: false });
            } else if (type === 'flasche') {
                cart.push({ name: 'Flasche zurück', price: -P_FLASCHE, type: 'flasche', isMain: false });
            }
            updateCart();
        }

        // Funktion zum Löschen des Warenkorbs
        function clearCart() {
            cart = [];
            updateCart();
        }
        
        // Funktion zum Aktualisieren des Warenkorbs und der Summen
        function updateCart() {
            const cartList = document.getElementById('cart-list');
            cartList.innerHTML = '';
            
            let subtotal = 0;
            let pfandSum = 0;
            let pfandMarken = 0;

            const groupedItems = {};
            
            cart.forEach(item => {
                const key = item.name;
                if (!groupedItems[key]) {
                    groupedItems[key] = { ...item, count: 0 };
                }
                groupedItems[key].count++;
            });

            // Definierte Sortierreihenfolge
            const sortOrder = [
                'Halbe', 
                'Weizen', 
                'Pfand Krug', 
                'Antialk', 
                'Pfand Flasche', 
                'Krug zurück', 
                'Flasche zurück'
            ];

            // Item-Informationen in der richtigen Reihenfolge durchlaufen
            sortOrder.forEach(itemName => {
                if (groupedItems[itemName]) {
                    const item = groupedItems[itemName];
                    const li = document.createElement('li');
                    li.classList.add('flex', 'justify-between', 'items-center', 'text-gray-700', 'text-sm');

                    const totalItemPrice = item.price * item.count;
                    
                    const canBeRemoved = item.isMain || item.name.includes('zurück');
                    const removeButton = canBeRemoved ? 
                        `<button class="text-red-500 hover:text-red-700 font-bold text-lg" onclick="removeItem('${item.name}')">×</button>` :
                        '';
                    
                    const fontClass = item.isMain ? 'font-bold' : 'font-normal';

                    li.innerHTML = `
                        <span class="text-gray-700 ${fontClass}">
                            ${item.count}x ${item.name}
                        </span>
                        <div class="flex items-center space-x-2">
                            <span class="font-medium">${totalItemPrice.toFixed(2).replace('.', ',')} €</span>
                            ${removeButton}
                        </div>
                    `;
                    
                    cartList.appendChild(li);
                }
            });

            // Separate Berechnung der Summen aus dem gesamten Warenkorb
            cart.forEach(item => {
                if (item.name.includes('Pfand') || item.name.includes('zurück')) {
                    pfandSum += item.price;
                    if (item.name.includes('zurück')) {
                        pfandMarken--;
                    } else {
                        pfandMarken++;
                    }
                } else {
                    subtotal += item.price;
                }
            });
            
            const total = subtotal + pfandSum;

            // Betrag und Pfandmarken-Anzeige updaten
            const totalElement = document.getElementById('total');
            const tokensElement = document.getElementById('pfand-marken-gesamt');

            totalElement.innerText = `${total.toFixed(2).replace('.', ',')} €`;
            tokensElement.innerText = pfandMarken;

            // Farben dynamisch anpassen
            totalElement.classList.remove('text-green-600', 'text-red-600');
            if (total > 0) {
                totalElement.classList.add('text-green-600');
            } else if (total < 0) {
                totalElement.classList.add('text-red-600');
            }

            tokensElement.classList.remove('text-green-600', 'text-red-600');
            if (pfandMarken > 0) {
                tokensElement.classList.add('text-red-600');
            } else if (pfandMarken < 0) {
                tokensElement.classList.add('text-green-600');
            }

            document.getElementById('subtotal').innerText = `${subtotal.toFixed(2).replace('.', ',')} €`;
            document.getElementById('pfand-sum').innerText = `${pfandSum.toFixed(2).replace('.', ',')} €`;
        }

        // Funktion zum Entfernen eines bestimmten Elements
        function removeItem(name) {
             // Behandlung der Rückgabe-Items
             if (name === 'Krug zurück' || name === 'Flasche zurück') {
                 const index = cart.findIndex(item => item.name === name);
                 if (index > -1) {
                     cart.splice(index, 1);
                 }
             } else {
                 // Behandlung der Hauptgetränke und ihrer Pfand-Positionen
                 const drinkIndex = cart.findIndex(item => item.name === name && item.isMain);
                 if (drinkIndex > -1) {
                     const drinkType = cart[drinkIndex].type;
                     cart.splice(drinkIndex, 1); // Entfernt das Hauptgetränk

                     const pfandName = (drinkType === 'krug') ? 'Pfand Krug' : 'Pfand Flasche';
                     const pfandIndex = cart.findIndex(item => item.name === pfandName);
                     if (pfandIndex > -1) {
                         cart.splice(pfandIndex, 1); // Entfernt eine einzelne Pfandposition
                     }
                 }
             }
             updateCart();
        }
    </script>
</body>
</html>
